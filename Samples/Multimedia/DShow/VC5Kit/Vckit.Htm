<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=windows-1252">
<META NAME="Generator" CONTENT="Microsoft Word 97">
<TITLE>Microsoft Developer Studio and DirectShow</TITLE>
</HEAD>
<BODY>

<B><FONT FACE="Albertus Medium" SIZE=4 COLOR="#ffffff"><P ALIGN="CENTER">Microsoft Developer Studio and DirectShow</P>
</B></FONT><FONT SIZE=2>
</FONT><B><FONT SIZE=4><P>Getting Started</P>
</B></FONT><FONT SIZE=2>
<P>Make sure you have installed Microsoft’s Visual C++ Developer Studio and the </FONT><FONT FACE="Arial" SIZE=1>DirectShow SDK<B> </B></FONT><FONT SIZE=2>including libraries, samples, and headers.</P>

<P>Set the Microsoft Developer Studio Include and Lib directories properly:</P>
<OL>

<LI>Bring up the <B>Options</B> dialog box by selecting <B>Options</B> from the <B>Tools</B> menu. Select the <B>Directories</B> tab.</LI>
<LI>Add the DirectShow include directories (by default: </FONT><FONT FACE="Courier New" SIZE=1>DXMEDIA\INCLUDE</FONT><FONT SIZE=2> and </FONT><FONT FACE="Courier New" SIZE=1>DXMEDIA\CLASSES\BASE</FONT><FONT SIZE=2>) to the list.</LI>
<LI>Select <B>Library files</B> in the <B>Show directories for:</B> combo-box.</LI>
<LI>Add the DirectShow library path (</FONT><FONT FACE="Courier New" SIZE=1>c:\DXMEDIA\LIB</FONT><FONT SIZE=2>). </LI></OL>


<P>Remember to link with </FONT><FONT FACE="Courier New" SIZE=1>QUARTZ.LIB STRMBASE.LIB</FONT><FONT SIZE=2> and </FONT><FONT FACE="Courier New" SIZE=1>LIBCMT.LIB</FONT><FONT SIZE=2> via the <B>Link</B> tab in the Microsoft Developer Studio <B>Build/Settings</B> dialog box, and check ‘<B>Ignore Default Libraries</B>.’ No further changes are required to build first DirectShow application. Filter developers should follow the steps below to install and customize the AMVCKIT.</P>

</FONT><FONT FACE="Wingdings" COLOR="#0000ff"><P>&nbsp;</P>
</FONT><B><FONT SIZE=4><P>Filter Development and Microsoft Visual C++ Developer Studio</P>
</B></FONT><FONT SIZE=2>
<P>The steps below explain how to customize AMVCKIT in preparation for filter development.</P>
</FONT>
<TABLE BORDER CELLSPACING=1 CELLPADDING=7 WIDTH=451>
<TR><TD VALIGN="TOP" BGCOLOR="#ffffff">
<FONT SIZE=2><P>Assumptions</FONT></TD>
</TR>
<TR><TD VALIGN="TOP" BGCOLOR="#ffffff">&nbsp;</TD>
</TR>
<TR><TD VALIGN="TOP" BGCOLOR="#ffffff">
<OL>

<FONT SIZE=2><LI>The </FONT><B><FONT FACE="Arial" SIZE=1>DirectShow Software Development Kit </B></FONT><FONT SIZE=2>has been installed in </FONT><FONT FACE="Courier New" SIZE=1>C:\DXMEDIA</FONT><FONT SIZE=2>.</FONT></TD>
</TR>
<TR><TD VALIGN="TOP" BGCOLOR="#ffffff">
<FONT SIZE=2><LI>The name for our sample filter will be </FONT><FONT FACE="Courier New" SIZE=1>FILTER</FONT><FONT SIZE=2>.</OL>
</FONT></TD>
</TR>
</TABLE>

<FONT SIZE=2>
</FONT><U><P><A NAME="Section1Name">Preliminary Setup</A></P>
</U><FONT SIZE=2>
<OL>

<LI>Choose a project name (we’re going to use </FONT><FONT FACE="Courier New" SIZE=1>FILTER</FONT><FONT SIZE=2>).</LI>
<LI>Create an empty directory for the project. [</FONT><FONT FACE="Courier New" SIZE=1>C:\FILTER</FONT><FONT SIZE=2>].</LI>
<LI>Copy the files (excluding this .doc file) into the directory just created [into </FONT><FONT FACE="Courier New" SIZE=1>C:\FILTER</FONT><FONT SIZE=2>].</LI>
<LI>If you already have a working project which you have developed you can keep your .DEF file and .RC file rather than reverting to those provided in AMVCKIT. However, be sure to read <U>Modifying the .DEF and RC files from the AMVCKIT</U> below and merge any necessary changes into your own files.</LI>
<LI>Copy the source .CPP and .H files into the project directory, as well as the .RC file and any other miscellaneous source files it requires. Do not copy any make files or compiler intermediate files. </LI></OL>

</FONT><U>
<P>Working with Microsoft Developer Studio</P>
</U><FONT SIZE=2>
<OL>

<LI>Run Microsoft Developer Studio and close any open projects.<BR>
</LI>
<LI>Open the [</FONT><FONT FACE="Courier New" SIZE=1>FILTER]</FONT><FONT SIZE=2> workspace [</FONT><FONT FACE="Courier New" SIZE=1>FILTER.DSW</FONT><FONT SIZE=2>] using <B>Open Workspace… </B>from the<B> File </B>menu.<B><BR>
</LI>
</B><LI>Add any .CPP files to the project by choosing <B>Files…</B> from the <B>Add to Project…</B> menu option under the <B>Project</B> menu.<BR>
</LI>
<LI>Bring up the <B>Settings</B> dialog box by selecting <B>Settings…</B> from the <B>Project</B> menu. Select the Link tab and set the Output file name to [</FONT><FONT FACE="Courier New" SIZE=1>C:\FILTER\FILTER.AX</FONT><FONT SIZE=2>].<BR>
</LI>
<LI>Choose <B>Save All</B> from the <B>File</B> menu.</LI></OL>

<P> </P>
</FONT><U><P>Modifying the .DEF and .RC files from the AMVCKIT</P>
</U><FONT SIZE=2>
<P>AMVCKIT includes a sample .DEF file and minimal .RC file you can use as a template if your are creating a new filter. If you have an existing project, treat the following steps as a checklist to make sure you have modified your files appropriately. This especially applies if you are modifying one of the samples provided with the DirectShow SDK.</P>

<OL>

<LI>Follow the steps listed in Appendix A to create your own GUID. Appendix A also provides more information about GUIDs. If you are using code from one of the AMSDK samples,  <B>please </B>generate a new GUID.</LI>
<LI>Save everything via <B>Save All</B> from the <B>File</B> menu.</LI></OL>


</FONT><U><P>The Test</P>
</U><FONT SIZE=2>
<OL>

<LI>Rebuild the entire project via <B>Rebuild All</B> from the <B>Build</B> menu. The project should build with <B>zero</B> errors and <B>two </B>warnings when built as Debug, and one warning when built as Release. </LI>
<LI>Install the filter by using the REGSVR32 program found in the \MSDEV\BIN directory. From the console window for example, REGSVR32 FILTER.AX. The REGSVR32 program will indicate success or failure via a dialog box.</LI>
<LI>Launch GraphEdit from (</FONT><FONT SIZE=1>C:\DXMEDIA\TOOLS\GRAPHEDT.EXE</FONT><FONT SIZE=2>) and try inserting the [</FONT><FONT FACE="Courier New" SIZE=1>FILTER</FONT><FONT SIZE=2>] filter.</LI></OL>


<P>&nbsp;</P>
<P>&nbsp;</P>
</FONT><P><A NAME="AppendixA">Appendix A - Generating New Globally Unique Identifiers (GUIDs)</A></P>
<FONT SIZE=2>
<P>In DirectShow, objects are identified by globally unique identifiers (GUIDs). Each filter is identified by a distinct GUID. Likewise, the filter’s property page is identified by a separate and distinct GUID. GUIDGEN is a Windows-based utility designed to generate GUIDs. Adding GUIDGEN to the Developer Studio <B>Tools</B> menu (via <B>Customize</B>) is a great time-saver. GUIDGEN can be found in the \MSDEV\BIN directory. If GUIDGEN.EXE was not installed, simply copy the executable from the Microsoft Developer Studio disc.</P>

<OL>

<LI>Run GUIDGEN (<I>handy if it's in the <B>Tools</B> menu</I>) and copy the new GUID in the DEFINE_GUID format. <I>Now you have a new GUID on the clipboard, ready to be pasted into your source code</FONT><FONT SIZE=1>.</I></FONT><FONT SIZE=2><BR>
</LI>
<LI>Replace the GUID declaration in your source code by pasting in the new GUID.<BR>
<I>For the steps below, imagine GUIDGEN created the following GUID:</FONT><FONT SIZE=1><BR>
<BR>
// {A0290240-8EF6-11cf-8F47-00AA0060D683}<BR>
DEFINE_GUID(&lt;&lt;name&gt;&gt;,<BR>
0xa0290240, 0x8ef6, 0x11cf, 0x8f, 0x47, 0x0, 0xaa, 0x0, 0x60, 0xd6, 0x83);<BR>
</LI>
</I></FONT><FONT SIZE=2><LI>Replace the </FONT><FONT FACE="Courier New" SIZE=1>&lt;&lt;name&gt;&gt;</FONT><FONT SIZE=2> in the filter's DEFINE_GUID macro accordingly [</FONT><FONT FACE="Courier New" SIZE=1>CLSID_FILTER</FONT><FONT SIZE=2>].</LI>
<LI>Copy the alpha-numeric sequence [</FONT><FONT FACE="Courier New" SIZE=1>{A0290240-8EF6-11cf-8F47-00AA0060D683}</FONT><FONT SIZE=2>], from the comment line above into the clipboard.</LI>
<LI>Save your changes.</LI>
<LI>Proceed with other modifications in step 3 of <U>Modifying the .DEF and .RC files from the AMVCKIT</U> above.</LI></OL>

<P><A NAME="AppendixB"></P>
<P></A>Appendix B - Details about the AMVCKIT kit.</P>

<P>The following information chronicles how the AMVCKIT project workspace was created in case the developer needs to reconstruct, refine or customize the environment.</P>

<OL>

<LI>Launch Developer Studio.</LI>
<LI>Create a new DLL project workspace named FILTER.</LI>
<LI>Modify the project’s <B>Build/Settings</B>…<BR>
<BR>
In the <B>Settings For:</B> portion of the Project Settings dialog, select both the Win32 Debug and Win32 Release entries.</LI></OL>

<OL TYPE="a">

<LI>Set the <B>Microsoft Foundation Classes:</B> setting of the General pane for <B>Not Using MFC</B>.</LI>
<LI>In the General category under C/C++, set the compiler at W3 (minimum).</LI>
<LI>Add the following Preprocessor Directives (<U>commas between directives</U>):<BR>
</FONT><B><FONT FACE="Arial" SIZE=1>INC_OLE2, STRICT, WIN32,_MT,_DLL,_X86_=1,WINVER=0x0400</LI>
</B></FONT><FONT SIZE=2><LI>In the C++ Language category, enable exception handling.</LI>
<LI>In the Code Generation category, set the processor setting to Blend.</LI>
<LI>In the Code Generation category, set the call convention to __stdcall.</LI>
<LI>In the Code Generation category, select multithreaded dlls..</LI>
<LI>In the Precompiled Headers category, disable use of precompiled headers.</LI>
<LI>In the Object/library module section, <B><U>start</B></U> the .lib list with </FONT><B><FONT FACE="Arial" SIZE=1>QUARTZ.LIB</B></FONT><FONT SIZE=2> </FONT><B><FONT FACE="Arial" SIZE=1>STRMBASE.LIB LIBCMT.LIB.</LI>
</B></FONT><FONT SIZE=2><LI>Select to <B>ignore default libraries</B>.</LI>
<LI>Disable the use of program databases under the Customize category.</LI>
<LI>In the Output category, set the base address to <B>0x1c400000</B>.</LI>
<LI>In the Output category, set the entry-point symbol to <B>DllEntryPoint@12</B>.</LI>
<LI>Back in the left Settings For pane, select the Debug entry.</LI>
<LI>In the General category under C/C++, enable generation of browse information.</LI>
<LI>In the Debug category under Link, enable generation of debug information.</LI>
<LI>Select C7 compatible debug information.</LI>
<LI>In the Code Generation category, select debug multithreaded dlls..</LI>
<LI>Under Browse Info, enable generation of browse information.<BR>
</LI></OL>

<OL START=4>

<LI>Copy the </FONT><B><FONT FACE="Arial" SIZE=1>.DEF</B></FONT><FONT SIZE=2> and </FONT><B><FONT FACE="Arial" SIZE=1>.RC</B></FONT><FONT SIZE=2> files from the SDK’s <B>BALL </B>sample, naming the files </FONT><B><FONT FACE="Arial" SIZE=1>FILTER.DEF</B></FONT><FONT SIZE=2> and </FONT><B><FONT FACE="Arial" SIZE=1>FILTER.RC</FONT><FONT SIZE=2> </B>respectively.</LI>
<LI>Add </FONT><B><FONT FACE="Arial" SIZE=1>FILTER.DEF</B></FONT><FONT SIZE=2> and </FONT><B><FONT FACE="Arial" SIZE=1>FILTER.RC</B></FONT><FONT SIZE=2>to the project via Insert/Files…</LI></OL>

<P>Save the entire environment via <B>File/Save All</B>.</P></FONT></BODY>
</HTML>
